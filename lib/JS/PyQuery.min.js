function makePython(){platform=require("os").platform,root=process.cwd()+"/",console.info("nw.js version:"+process.version),console.info("platform:"+platform()),console.info("root directory:"+root),"win32"==platform&&(root=root.replaceAll("/","\\"),pyDir=pyDir.replaceAll("/","\\"));var e=require("child_process").spawn;return py={process:e("python",["-u",root+pyDir]),onLog:function(e){console.log("python log: "+e)},onCommand:{},onRequest:{},call:function(e,n){res="<*>"+e+"<*>"+n,res=res.replaceAll("\n"," "),res+="\n",py.process.stdin.write(res)},onClose:function(e){console.log("python exited with code "+e)},onError:function(e){console.error("python had error:\n"+e)},add:{commandHandler:function(e,n){py.onCommand[e]=n},requestHandler:function(e,n){py.onRequest[e]=n}}},py.process.stdout.on("data",function(e){e=e.toString(),e.split("\n").forEach(function(e){"<*>"==e.substring(0,3)?(e=e.split("<*>"),py.onCommand[e[1]](JSON.parse(e[2]))):"<:>"==e.substring(0,3)?(e=e.split("<:>"),res=py.onRequest[e[1]](JSON.parse(e[2])),res=JSON.stringify(res),res="<:>"+e[1]+"<:>"+res,res=res.replaceAll("\n"," "),res+="\n",py.process.stdin.write(res)):""!=e&&py.onLog(e)})}),py.process.stderr.on("data",function(e){e=e.toString(),py.onError(e)}),py.process.on("close",function(e){py.onClose(e)}),py.kill=function(){py.process.kill(),console.warn("killing Python...")},py}var pyDir="../lib/PY/main.py",root,platform;$(function(){function o(n,o){return isNaN(o)?$(n):e[o]}var e=[],n=0;python=makePython(),python.add.commandHandler("warn",function(e){console.warn("Python Warns:"+e.msg)}),python.add.commandHandler("alert",function(e){alert(e.msg)}),python.add.commandHandler("killMe",function(){py.kill(),console.warn("Python is requesting death"),alert("Python Suicided")}),python.add.commandHandler("css",function(e){o(e.selector,e.index).css(e.rules)}),python.add.commandHandler("html",function(e){o(e.selector,e.index).html(e.text)}),python.add.commandHandler("append",function(e){o(e.selector,e.index).append(e.text)}),python.add.commandHandler("attribute",function(e){o(e.selector,e.index).attr(e.property,e.value)}),python.add.commandHandler("toggleClass",function(e){o(e.selector,e.index).toggleClass(e.class)}),python.add.commandHandler("callback",function(e){o(e.selector,e.index)[e.type](function(){""==this.id&&(n++,this.id="PlaceholderId"+n),py.call(e.name,"#"+this.id)})}),python.add.requestHandler("index",function(n){return i=e.length,e[i]=$(n.selector),i}),python.add.requestHandler("attribute",function(e){return o(e.selector,e.index).attr(e.property)}),python.add.requestHandler("css",function(e){return o(e.selector,e.index).css(e.property)}),python.add.requestHandler("html",function(e){return o(e.selector,e.index).html()}),python.add.requestHandler("size",function(e){return o(e.selector,e.index).size()})}),String.prototype.reverse=function(){return this.split("").reverse().join("")},String.prototype.replaceLast=function(e,n){return this.reverse().replace(new RegExp(e.reverse()),n.reverse()).reverse()},String.prototype.replaceAll=function(e,n){return this.split(e).join(n)};